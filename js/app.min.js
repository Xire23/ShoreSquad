/**
 * ShoreSquad - Minified App with Cleanup Spot Selection
 * Production-ready, optimized for <1s load on 4G
 */
'use strict';const AppState={userLocation:null,weatherData:null,selectedCleanupSpot:'east-coast',crews:JSON.parse(localStorage.getItem('shoreSquadCrews'))||[],events:JSON.parse(localStorage.getItem('shoreSquadEvents'))||[],saveCrews(){try{localStorage.setItem('shoreSquadCrews',JSON.stringify(this.crews))}catch(e){console.error('Save crews error:',e)}},saveEvents(){try{localStorage.setItem('shoreSquadEvents',JSON.stringify(this.events))}catch(e){console.error('Save events error:',e)}}};const DOM={mapContainer:null,mapButton:null,weatherDashboard:null,crewList:null,createCrewBtn:null,getStartedBtn:null,nextCleanupInfo:null,joinCleanupBtn:null,cleanupTitle:null,cleanupLocation:null,cleanupDate:null,cleanupDifficulty:null,init(){try{this.mapContainer=document.getElementById('mapContainer');this.mapButton=document.getElementById('enableLocationBtn');this.weatherDashboard=document.getElementById('weatherDashboard');this.crewList=document.getElementById('crewList');this.createCrewBtn=document.getElementById('createCrewBtn');this.getStartedBtn=document.getElementById('getStartedBtn');this.nextCleanupInfo=document.getElementById('nextCleanupInfo');this.joinCleanupBtn=document.getElementById('joinCleanupBtn');this.cleanupTitle=document.getElementById('cleanupTitle');this.cleanupLocation=document.getElementById('cleanupLocation');this.cleanupDate=document.getElementById('cleanupDate');this.cleanupDifficulty=document.getElementById('cleanupDifficulty');console.log('âœ… DOM ready')}catch(e){console.error('DOM init error:',e)}}};const LocationService={cleanupSpots:[{name:'East Coast Park',lat:1.3024,lng:103.9620,mapId:'east-coast',description:'10 km pristine coastline',difficulty:'Easy'},{name:'Pasir Ris Beach',lat:1.3815,lng:103.9556,mapId:'pasir-ris',description:'Beach with mangroves',difficulty:'Medium'},{name:'Sentosa Beach',lat:1.2494,lng:103.8303,mapId:'sentosa',description:'Popular beach',difficulty:'Easy'},{name:'Changi Beach',lat:1.4050,lng:103.9765,mapId:'changi',description:'Historic beach',difficulty:'Hard'}],async requestLocation(){try{console.log('ğŸ“ Getting location...');if(!navigator.geolocation)throw new Error('Geolocation not supported');UI.showLoading(!0,'ğŸ“ Getting your location...');return new Promise(e=>{navigator.geolocation.getCurrentPosition(t=>{try{const{latitude:a,longitude:i,accuracy:n}=t.coords;AppState.userLocation={latitude:a,longitude:i,accuracy:n};console.log(`âœ… Location: ${a.toFixed(4)}, ${i.toFixed(4)} Â±${n}m`);UI.showLoading(!1);UI.showAlert('ğŸ“ Location enabled!','success');e(!0)}catch(t){console.error('âŒ Location processing:',t);UI.showAlert('âŒ Error processing location','error');UI.showLoading(!1);e(!1)}},t=>{UI.showLoading(!1);let a='Unable to get location';1===t.code?a='Permission denied. Enable location in settings.':2===t.code?a='Location unavailable. Check GPS.':3===t.code&&(a='Location request timeout.');console.error(`âŒ Geolocation error (${t.code}): ${a}`);UI.showAlert(`âŒ ${a}`,'error');e(!1)},{timeout:1e4,enableHighAccuracy:!0,maximumAge:0})})}catch(e){return console.error('âŒ Location error:',e),UI.showAlert('âŒ Error: '+e.message,'error'),UI.showLoading(!1),!1}},getNearestSpot(){try{if(!AppState.userLocation)return console.warn('âš ï¸ No location'),this.cleanupSpots[0];const{latitude:e,longitude:t}=AppState.userLocation;let a=this.cleanupSpots[0],i=1/0;return this.cleanupSpots.forEach(n=>{const o=Math.sqrt(Math.pow(n.lat-e,2)+Math.pow(n.lng-t,2));o<i&&(i=o,a=n)}),console.log(`ğŸ“ Nearest: ${a.name} (${(111*i).toFixed(1)}km away)`),a}catch(e){return console.error('âŒ Nearest spot error:',e),this.cleanupSpots[0]}}};const WeatherService={async fetchWeather(){try{UI.showLoading(!0,'ğŸŒ¤ï¸ Loading weather from NEA...');console.log('ğŸ“¡ Fetching NEA API...');const e='https://api.data.gov.sg/v1/environment/24-hour-weather-forecast',t=await fetch(e,{method:'GET',headers:{'Accept':'application/json'}});if(!t.ok)throw new Error(`HTTP ${t.status}`);const a=await t.json();if(console.log('âœ… NEA Response:',a),!a.items||0===a.items.length)throw new Error('No weather data');UI.showLoading(!1);AppState.weatherData=a;this.displayWeather(a);UI.showAlert('ğŸŒ¤ï¸ Real weather loaded!','success');console.log('âœ… Weather ready')}catch(e){UI.showLoading(!1);console.error('âŒ Weather API error:',e.message);console.warn('ğŸ“¦ Fallback to mock data');UI.showAlert(`âš ï¸ Mock data: ${e.message}`,'info');this.displayMockWeather()}},displayWeather(e){try{if(!e.items||0===e.items.length)throw new Error('No items');const t=e.items[0],a=t.forecasts||[],i=t.valid_period?.start||new Date().toISOString();console.log(`ğŸ“Š Showing ${a.length} forecasts`);let n=`<div class="weather-card" style="grid-column:1/-1;background:linear-gradient(135deg,#667eea,#764ba2)"><div class="weather-date">Updated: ${new Date(i).toLocaleTimeString()}</div><div class="weather-condition">ğŸŒ Singapore 24-Hour</div></div>`;a.slice(0,8).forEach(e=>{const t=this.getEmoji(e.forecast),a=new Date(e.timestamp).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});n+=`<div class="weather-card"><div class="weather-date">${a}</div><div class="weather-emoji">${t}</div><div class="weather-condition">${e.forecast}</div><div class="weather-detail">ğŸ’§ ${e.relative_humidity}%</div></div>`});DOM.weatherDashboard.innerHTML=n;console.log('âœ… Weather rendered')}catch(e){console.error('âŒ Display error:',e);this.displayMockWeather()}},displayMockWeather(){try{console.log('ğŸ­ Mock weather');const e=[{time:'12:00',emoji:'â˜€ï¸',condition:'Sunny',humidity:65},{time:'15:00',emoji:'â›…',condition:'Cloudy',humidity:72},{time:'18:00',emoji:'ğŸŒ§ï¸',condition:'Rain',humidity:85},{time:'21:00',emoji:'â›ˆï¸',condition:'Storm',humidity:90},{time:'00:00',emoji:'ğŸŒ™',condition:'Clear',humidity:60},{time:'03:00',emoji:'ğŸŒ«ï¸',condition:'Haze',humidity:70},{time:'06:00',emoji:'ğŸŒ',condition:'Sunny',humidity:55},{time:'09:00',emoji:'â›…',condition:'Mostly Sunny',humidity:68}];let t=`<div class="weather-card" style="grid-column:1/-1;background:linear-gradient(135deg,#667eea,#764ba2)"><div class="weather-date">Mock 24-Hour</div><div class="weather-condition">ğŸŒ Singapore (Demo)</div></div>`;e.forEach(e=>{t+=`<div class="weather-card"><div class="weather-date">${e.time}</div><div class="weather-emoji">${e.emoji}</div><div class="weather-condition">${e.condition}</div><div class="weather-detail">ğŸ’§ ${e.humidity}%</div></div>`});DOM.weatherDashboard.innerHTML=t;console.log('âœ… Mock ready')}catch(e){console.error('âŒ Mock error:',e);DOM.weatherDashboard.innerHTML='<p>âŒ Error loading weather</p>'}},getEmoji(e){const t=e.toLowerCase();return t.includes('rain')||t.includes('shower')?'ğŸŒ§ï¸':t.includes('thunder')||t.includes('lightning')?'â›ˆï¸':t.includes('cloudy')||t.includes('overcast')?'â˜ï¸':t.includes('clear')||t.includes('sunny')?'â˜€ï¸':t.includes('partly')?'â›…':t.includes('haze')||t.includes('mist')?'ğŸŒ«ï¸':t.includes('fog')?'ğŸŒ':'ğŸŒ¤ï¸'}};const CrewService={createCrew(){try{const e=prompt('Crew name?');if(!e||''===e.trim())return void UI.showAlert('âš ï¸ Enter crew name','info');const t={id:Date.now(),name:e.trim(),members:['You'],cleanups:0,trashCollected:0,createdAt:new Date().toISOString()};AppState.crews.push(t);AppState.saveCrews();UI.showAlert(`ğŸ‰ Crew "${e}" created!`,'success');this.displayCrews()}catch(e){console.error('âŒ Crew error:',e);UI.showAlert('âŒ Error creating crew','error')}},displayCrews(){try{if(0===AppState.crews.length)return void(DOM.crewList.innerHTML='<p>No crews yet</p>');let e='';AppState.crews.forEach(t=>{e+=`<div class="crew-placeholder"><h3>${t.name}</h3><p>ğŸ‘¥ ${t.members.length} members</p><p>ğŸ—‘ï¸ ${t.trashCollected} kg</p></div>`});DOM.crewList.innerHTML=e}catch(e){console.error('âŒ Display crews error:',e)}}};const CleanupService={cleanupSpots:[{id:'east-coast',name:'East Coast Park',location:'1.3024Â°N, 103.9620Â°E',date:'Saturday, Dec 7',time:'9:00 AM',difficulty:'Easy',members:12,emoji:'ğŸ“'},{id:'pasir-ris',name:'Pasir Ris Beach',location:'1.3815Â°N, 103.9556Â°E',date:'Sunday, Dec 8',time:'8:30 AM',difficulty:'Medium',members:15,emoji:'ğŸ–ï¸'},{id:'sentosa',name:'Sentosa Beach',location:'1.2494Â°N, 103.8303Â°E',date:'Saturday, Dec 14',time:'10:00 AM',difficulty:'Easy',members:10,emoji:'ğŸŒ´'},{id:'changi',name:'Changi Beach',location:'1.4050Â°N, 103.9765Â°E',date:'Sunday, Dec 15',time:'7:00 AM',difficulty:'Hard',members:8,emoji:'ğŸŒŠ'}],getSpotById(e){return this.cleanupSpots.find(t=>t.id===e)||this.cleanupSpots[0]},updateCleanupInfo(e){try{const t=this.getSpotById(e);console.log('ğŸŒŠ Updating cleanup info to:',t.name);DOM.cleanupTitle.textContent=`${t.emoji} Next Cleanup: ${t.name}`;DOM.cleanupLocation.textContent=`ğŸ“ Location: ${t.location}`;DOM.cleanupDate.textContent=`ğŸ“… ${t.date} @ ${t.time}`;DOM.cleanupDifficulty.textContent=`â­ Difficulty: ${t.difficulty} | ğŸ‘¥ ${t.members} crew members`;AppState.selectedCleanupSpot=e;console.log('âœ… Cleanup info updated')}catch(e){console.error('âŒ Error updating cleanup info:',e)}},joinCleanup(){try{console.log('ğŸŒŠ User joining cleanup...');const e=AppState.selectedCleanupSpot||'east-coast',t=this.getSpotById(e);const i={id:Date.now(),spotId:e,location:t.name,date:t.date,time:t.time,difficulty:t.difficulty,participants:t.members,joinedAt:new Date().toISOString()};AppState.events.push(i);AppState.saveEvents();console.log('âœ… Joined cleanup:',i);this.showJoinConfirmation(t.name)}catch(e){console.error('âŒ Error joining cleanup:',e);UI.showAlert('âŒ Error joining cleanup','error')}},showJoinConfirmation(e){try{const t=document.createElement('div');t.className='join-confirmation-popup';t.innerHTML=`<div class="popup-content"><div class="popup-emoji">ğŸ‰</div><h3>You have joined the cleanup!</h3><p>${e}</p></div>`;document.body.appendChild(t);console.log('âœ… Confirmation popup shown');setTimeout(()=>{t.classList.add('fade-out');setTimeout(()=>t.remove(),300)},4e3)}catch(e){console.error('âŒ Error showing confirmation:',e)}}};const UI={showAlert(e,t='info'){try{console.log(`[${t.toUpperCase()}] ${e}`);const a=document.createElement('div');a.className=`toast ${t}`;a.textContent=e;a.setAttribute('role','alert');document.body.appendChild(a);setTimeout(()=>a.remove(),4e3)}catch(e){console.error('Alert error:',e)}},showLoading(e,t='Loading...'){try{let a=document.getElementById('appLoader');e?a||(a=document.createElement('div'),a.id='appLoader',a.style.cssText='position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:white;padding:2rem;border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,.15);z-index:3000;text-align:center',document.body.appendChild(a)),a.innerHTML=`<div class="spinner"></div><p>${t}</p>`,a.style.display='block':a&&(a.style.display='none')}catch(e){console.error('Loading error:',e)}},smoothScroll(e){try{const t=document.querySelector(e);t&&t.scrollIntoView({behavior:'smooth'})}catch(e){console.error('Scroll error:',e)}}};function setupEventListeners(){try{DOM.mapButton&&DOM.mapButton.addEventListener('click',async()=>{try{console.log('ğŸ”˜ Location btn');const e=await LocationService.requestLocation();e&&(console.log('ğŸŒ Fetching weather'),await WeatherService.fetchWeather(),LocationService.getNearestSpot(),UI.smoothScroll('#weather'))}catch(e){console.error('âŒ Location handler:',e)}}),DOM.createCrewBtn&&DOM.createCrewBtn.addEventListener('click',()=>{try{CrewService.createCrew()}catch(e){console.error('âŒ Create crew:',e)}}),DOM.joinCleanupBtn&&DOM.joinCleanupBtn.addEventListener('click',()=>{try{console.log('ğŸ¯ Join cleanup button clicked');CleanupService.joinCleanup()}catch(e){console.error('âŒ Join button error:',e)}}),DOM.getStartedBtn&&DOM.getStartedBtn.addEventListener('click',()=>{try{UI.smoothScroll('#map')}catch(e){console.error('âŒ Get started:',e)}}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener('click',t=>{try{const a=t.currentTarget.getAttribute('href');'#'!==a&&(t.preventDefault(),UI.smoothScroll(a))}catch(e){console.error('âŒ Nav error:',e)}})}),document.querySelectorAll('.map-spot-btn').forEach(e=>{e.addEventListener('click',t=>{try{const a=t.currentTarget.dataset.map;console.log('ğŸ—ºï¸ Cleanup spot clicked:',a);document.querySelectorAll('.map-spot-btn').forEach(e=>e.classList.remove('active'));t.currentTarget.classList.add('active');CleanupService.updateCleanupInfo(a);document.querySelectorAll('#mapContainer > div').forEach(e=>{e.style.display='none'});const i=a+'-map',n=document.getElementById(i);n?(n.style.display='block',console.log('âœ… Map:',i)):console.warn('âš ï¸ Not found:',i)}catch(e){console.error('âŒ Map button error:',e);UI.showAlert('âŒ Error selecting cleanup spot: '+e.message,'error')}})}),console.log('âœ… Listeners ready')}catch(e){console.error('Listener setup error:',e)}}function initApp(){try{console.log('ğŸ„ ShoreSquad init');DOM.init();setupEventListeners();CrewService.displayCrews();console.log('âœ… Ready!')}catch(e){console.error('Init error:',e)}}'loading'===document.readyState?document.addEventListener('DOMContentLoaded',initApp):initApp();

